<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 關鍵詞搜索</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Serif TC', serif;
            background-color: #f0f4f2; /* 淡淡的青綠底色 */
        }
        .search-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #d1dbd6;
        }
        .result-item:hover {
            transform: translateX(8px);
            background-color: #e6eee9;
        }
    </style>
</head>
<body class="min-h-screen text-slate-800">

<div id="root"></div>

<script type="text/babel">
    const { useState } = React;

    const App = () => {
        const [query, setQuery] = useState("");
        const [results, setResults] = useState([]);
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState("");

        // 設定區
        const CONFIG = {
            GEMINI_API_KEY: "AIzaSyAuH8gZ-BdtSq1S2EYvOMxrBFaFl2g-ePU", // 請填入你的 Key
            JINA_TOKEN: "jina_d9fc3cb689f545fb9cd81f2301508417kjelTyrF7Og8VwdzG5O9kQ9nB-z8"       // 請填入你的 Key
        };

        const handleSearch = async () => {
            if (!query.trim()) return;
            
            setIsLoading(true);
            setError("");
            setResults([]);

            try {
                // 1. 編碼關鍵詞 (處理中文)
                const encodedQuery = encodeURIComponent(query);
                
                // 2. 呼叫 Jina Search API
                // 我們使用 s.jina.ai 來進行全網搜索
                const jinaResponse = await fetch(`https://s.jina.ai/${encodedQuery}`, {
                    headers: {
                        'Accept': 'application/json',
                        'Authorization': `Bearer ${CONFIG.JINA_TOKEN}`
                    }
                });
                
                if (!jinaResponse.ok) throw new Error("搜索服務暫時不可用");
                const jinaData = await jinaResponse.json();
                
                // 獲取前幾筆內容摘要供 AI 分析
                const searchContent = jinaData.data.map(item => `標題: ${item.title}\n連結: ${item.url}\n摘要: ${item.description}`).join("\n\n");

                // 3. 呼叫 Gemini 進行整理
                const prompt = `
                    你是一個資訊整理助手。以下是關於「${query}」的網路搜索結果。
                    請從中篩選出最相關、最高品質的 8 個網頁。
                    請僅回傳 JSON 格式陣列，結構如下：
                    [
                        {"title": "網頁標題", "url": "網頁連結", "desc": "一句話簡介"}
                    ]
                    
                    搜尋結果內容：
                    ${searchContent}
                `;

                const geminiResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${CONFIG.GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ role: 'user', parts: [{ text: prompt }] }]
                    })
                });

                const geminiData = await geminiResponse.json();
                let rawJson = geminiData.candidates[0].content.parts[0].text;
                
                // 清理可能包含的 Markdown 語法
                rawJson = rawJson.replace(/```json/g, '').replace(/```/g, '').trim();
                const finalResults = JSON.parse(rawJson);
                
                setResults(finalResults);

            } catch (err) {
                console.error(err);
                setError("搜尋過程中發生錯誤，請檢查 API Key 或稍後再試。");
            } finally {
                setIsLoading(false);
            }
        };

        return (
            <div className="max-w-3xl mx-auto px-6 py-12">
                <header className="text-center mb-12">
                    <h1 className="text-3xl font-bold text-emerald-800 mb-2">AI 關鍵詞搜索</h1>
                    <p className="text-emerald-600/70 text-sm italic"></p>
                </header>

                {/* 搜尋欄 */}
                <div className="search-card p-2 rounded-2xl shadow-sm flex items-center gap-2 mb-10">
                    <input 
                        type="text" 
                        value={query}
                        onChange={(e) => setQuery(e.target.value)}
                        onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                        placeholder="輸入關鍵詞（例如：2025 AI 趨勢）..."
                        className="flex-1 bg-transparent border-none focus:ring-0 px-4 py-2 text-lg outline-none"
                    />
                    <button 
                        onClick={handleSearch}
                        disabled={isLoading}
                        className="bg-emerald-700 hover:bg-emerald-800 text-white px-6 py-2 rounded-xl transition-all disabled:opacity-50 font-medium"
                    >
                        {isLoading ? "探索中..." : "搜尋"}
                    </button>
                </div>

                {/* 錯誤顯示 */}
                {error && (
                    <div className="bg-red-50 border border-red-100 text-red-600 px-4 py-3 rounded-lg text-center mb-6 text-sm">
                        {error}
                    </div>
                )}

                {/* 結果列表 */}
                <div className="space-y-4">
                    {results.length > 0 ? (
                        results.map((item, idx) => (
                            <a 
                                key={idx} 
                                href={item.url} 
                                target="_blank" 
                                rel="noopener noreferrer"
                                className="result-item block p-5 rounded-xl border border-slate-200 bg-white transition-all duration-300 shadow-sm"
                            >
                                <div className="flex justify-between items-start mb-1">
                                    <h3 className="font-bold text-lg text-emerald-900 leading-snug">{item.title}</h3>
                                    <svg className="w-5 h-5 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </div>
                                <p className="text-slate-500 text-sm mb-2">{item.desc}</p>
                                <span className="text-xs font-mono text-emerald-600 opacity-60 truncate block">{item.url}</span>
                            </a>
                        ))
                    ) : (
                        !isLoading && (
                            <div className="text-center py-20 text-slate-400">
                                <svg className="w-12 h-12 mx-auto mb-3 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                                <p>等待指令中，請輸入感興趣的主題</p>
                            </div>
                        )
                    )}
                </div>

                {/* Loading 骨架屏 */}
                {isLoading && (
                    <div className="space-y-4 animate-pulse">
                        {[1, 2, 3].map(i => (
                            <div key={i} className="h-28 bg-slate-200 rounded-xl"></div>
                        ))}
                    </div>
                )}
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>

</body>
</html>