<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éˆæ„Ÿå…·è±¡åŒ–</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        /* èƒŒæ™¯æµå‹•å‹•ç•« */
        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .animate-gradient-bg {
            background-size: 300% 300%;
            animation: gradient-flow 20s ease infinite;
        }

        /* è‡ªå®šç¾©æ»¾å‹•æ¢ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Loading å‹•ç•« */
        .loader-dots div {
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }
        .loader-dots div:nth-child(1) {
            left: 8px;
            animation: loader-dots1 0.6s infinite;
        }
        .loader-dots div:nth-child(2) {
            left: 8px;
            animation: loader-dots2 0.6s infinite;
        }
        .loader-dots div:nth-child(3) {
            left: 32px;
            animation: loader-dots2 0.6s infinite;
        }
        .loader-dots div:nth-child(4) {
            left: 56px;
            animation: loader-dots3 0.6s infinite;
        }
        @keyframes loader-dots1 {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }
        @keyframes loader-dots3 {
            0% { transform: scale(1); }
            100% { transform: scale(0); }
        }
        @keyframes loader-dots2 {
            0% { transform: translate(0, 0); }
            100% { transform: translate(24px, 0); }
        }

        /* åœ–ç‰‡æ·¡å…¥æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.8s ease-in-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 animate-gradient-bg min-h-screen text-white selection:bg-pink-500 selection:text-white">

    <div class="max-w-lg mx-auto min-h-screen flex flex-col p-4 md:p-6">

        <header class="mb-8 text-center mt-4">
            <div class="relative inline-block group">
                <div class="absolute -inset-1 bg-gradient-to-r from-pink-600 to-violet-600 rounded-full blur opacity-40 group-hover:opacity-75 transition duration-500"></div>
                <div class="relative p-4 rounded-full bg-black/30 backdrop-blur-md border border-white/10">
                    <i class="fas fa-bolt text-3xl text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-violet-400"></i>
                </div>
            </div>
            <h1 class="text-3xl font-bold mt-4 bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">éˆæ„Ÿå…·è±¡åŒ–</h1>
            <p class="text-xs text-gray-400 mt-2 tracking-wide uppercase">AI Translation & Generation</p>
        </header>

        <div class="bg-gray-900/40 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/10 p-6 space-y-6 relative overflow-hidden">
            
            <div class="absolute -top-24 -right-24 w-48 h-48 bg-pink-500 rounded-full blur-3xl opacity-10 pointer-events-none"></div>
            <div class="absolute -bottom-24 -left-24 w-48 h-48 bg-violet-500 rounded-full blur-3xl opacity-10 pointer-events-none"></div>

            <div>
                <label class="flex items-center text-sm font-medium text-gray-300 mb-2 ml-1">
                    <i class="fas fa-pen mr-2 text-pink-400"></i> å ´æ™¯æè¿°
                </label>
                <div class="relative">
                    <textarea id="storyInput" rows="3"
                        class="w-full bg-black/30 border border-white/10 rounded-2xl p-4 text-white placeholder-gray-500 focus:ring-2 focus:ring-pink-500/50 focus:border-pink-500/50 outline-none transition-all resize-none text-sm leading-relaxed"
                        placeholder="ä¸€éš»æˆ´è‘—å¤ªç©ºäººé ­ç›”çš„è²“å’ªï¼Œæ¼‚æµ®åœ¨å……æ»¿ç”œç”œåœˆçš„éŠ€æ²³ç³»ä¸­..."></textarea>
                </div>
            </div>

            <div>
                <label class="flex items-center text-sm font-medium text-gray-300 mb-3 ml-1">
                    <i class="fas fa-palette mr-2 text-violet-400"></i> è—è¡“é¢¨æ ¼
                </label>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="styleContainer">
                    <button onclick="setStyle(this, cinematicStyle)" class="style-btn group active relative overflow-hidden rounded-xl p-3 border text-left transition-all duration-300 bg-gradient-to-br from-pink-600 to-purple-700 border-pink-400/50 ring-2 ring-pink-500/30 shadow-lg shadow-pink-900/20">
                        <div class="text-lg mb-1 opacity-70 group-hover:opacity-100 group-[.active]:opacity-100 transition">ğŸ¥</div>
                        <div class="text-xs font-medium text-gray-400 group-hover:text-white group-[.active]:text-white transition">é›»å½±å¯«å¯¦</div>
                    </button>
                    
                    <button onclick="setStyle(this, animeStyle)" class="style-btn group relative overflow-hidden rounded-xl p-3 border border-white/5 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-300 text-left">
                        <div class="text-lg mb-1 opacity-70 group-hover:opacity-100 transition">ğŸŒ¸</div>
                        <div class="text-xs font-medium text-gray-400 group-hover:text-white transition">æ—¥ç³»å‹•æ¼«</div>
                    </button>

                    <button onclick="setStyle(this, cyberpunkStyle)" class="style-btn group relative overflow-hidden rounded-xl p-3 border border-white/5 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-300 text-left">
                        <div class="text-lg mb-1 opacity-70 group-hover:opacity-100 transition">ğŸ¤–</div>
                        <div class="text-xs font-medium text-gray-400 group-hover:text-white transition">è³½åšé¾å…‹</div>
                    </button>

                    <button onclick="setStyle(this, oilStyle)" class="style-btn group relative overflow-hidden rounded-xl p-3 border border-white/5 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-300 text-left">
                        <div class="text-lg mb-1 opacity-70 group-hover:opacity-100 transition">ğŸ¨</div>
                        <div class="text-xs font-medium text-gray-400 group-hover:text-white transition">å°è±¡æ²¹ç•«</div>
                    </button>

                    <button onclick="setStyle(this, pixarStyle)" class="style-btn group relative overflow-hidden rounded-xl p-3 border border-white/5 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-300 text-left">
                        <div class="text-lg mb-1 opacity-70 group-hover:opacity-100 transition">ğŸ§¸</div>
                        <div class="text-xs font-medium text-gray-400 group-hover:text-white transition">3D å¡é€š</div>
                    </button>

                    <button onclick="setStyle(this, darkStyle)" class="style-btn group relative overflow-hidden rounded-xl p-3 border border-white/5 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-300 text-left">
                        <div class="text-lg mb-1 opacity-70 group-hover:opacity-100 transition">ğŸ’€</div>
                        <div class="text-xs font-medium text-gray-400 group-hover:text-white transition">æš—é»‘å¥‡å¹»</div>
                    </button>
                </div>
            </div>

            <button onclick="generateImage()" id="generateBtn"
                class="w-full relative overflow-hidden rounded-2xl p-[2px] group focus:outline-none focus:ring-4 focus:ring-purple-500/30 transition-transform active:scale-[0.98]">
                <span class="absolute inset-[-1000%] animate-[spin_4s_linear_infinite] bg-[conic-gradient(from_90deg_at_50%_50%,#E2E8F0_0%,#500724_50%,#E2E8F0_100%)] group-hover:bg-[conic-gradient(from_90deg_at_50%_50%,#EC4899_0%,#8B5CF6_50%,#EC4899_100%)]"></span>
                <span class="relative flex h-full w-full items-center justify-start pl-7 pr-20 gap-3 rounded-2xl bg-gray-900 py-4 text-sm font-bold text-white backdrop-blur-3xl transition group-hover:bg-gray-900/80">
  <i class="fas fa-wand-magic-sparkles text-pink-400 text-lg"></i>
  <span id="btnText">AI è§£æä¸¦ç”Ÿåœ–</span>
</span>
</button>
        </div>

        <div id="resultCard" class="hidden mt-6 fade-in">
            <div class="bg-gray-900/40 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/10 overflow-hidden">
                
                <div class="relative aspect-square bg-black/50 flex items-center justify-center group">
                    
                    <div id="loadingSpinner" class="hidden absolute inset-0 flex-col items-center justify-center bg-black/60 backdrop-blur-sm z-10">
                        <div class="loader-dots relative inline-block w-20 h-5">
                            <div class="absolute top-2 w-3 h-3 rounded-full bg-pink-500"></div>
                            <div class="absolute top-2 w-3 h-3 rounded-full bg-pink-500"></div>
                            <div class="absolute top-2 w-3 h-3 rounded-full bg-pink-500"></div>
                            <div class="absolute top-2 w-3 h-3 rounded-full bg-violet-500"></div>
                        </div>
                        <span id="statusText" class="mt-4 text-xs font-medium text-pink-300 animate-pulse tracking-widest">AI æ­£åœ¨æ§‹å»ºä¸–ç•Œ...</span>
                    </div>

                    <img id="resultImage" src="" alt="Generated Scene"
                         class="w-full h-full object-cover hidden transition-transform duration-700 group-hover:scale-105"
                         onload="onImageLoad()">
                </div>

                <div class="p-5 border-t border-white/5 bg-white/5 backdrop-blur-md">
                    <div class="flex justify-between items-center gap-4">
                        <div class="flex-1 min-w-0">
                            <p class="text-[10px] text-gray-400 uppercase tracking-wider mb-1">Translated Prompt</p>
                            <p class="text-sm text-gray-200 truncate" id="promptDisplay">...</p>
                        </div>
                        
                        <button onclick="downloadCurrentImg()" id="downloadBtn" 
                            class="flex-shrink-0 bg-white text-gray-900 hover:bg-gray-200 px-5 py-2.5 rounded-full text-sm font-bold transition-colors shadow-lg shadow-white/10 flex items-center gap-2">
                            <i class="fas fa-download"></i>
                            <span>ä¸‹è¼‰</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-auto py-8 text-center space-y-1">
            <p class="text-xs text-gray-500">Powered by Pollinations.ai (Flux) & SiliconFlow (Qwen)</p>
            <p class="text-[10px] text-gray-600">Â© 2025 AI Story Visualizer</p>
        </footer>
    </div>

    <script>
        // --- AI API é…ç½® ---
        // è«‹åœ¨æ­¤è™•å¡«å…¥æ‚¨çš„ API KEY
        const API_URL = 'https://api.siliconflow.cn/v1/chat/completions';
        const API_KEY = 'sk-noswzgohhrfqafnlbkyjefbogajzqbsnzdjtpwykohwtxqtf'; // <-- åœ¨æ­¤å¡«å…¥æ‚¨çš„ API Key
        const MODEL_NAME = 'Qwen/Qwen2.5-7B-Instruct';

        // --- é¢¨æ ¼è¨­å®š ---
        const cinematicStyle = "A highly detailed cinematic scene, photorealistic, 8k clarity, dramatic lighting, depth of field, movie still";
        const animeStyle = "A vibrant anime-style illustration, Studio Ghibli aesthetic, soft cel shading, expressive colors, high quality anime art";
        const cyberpunkStyle = "A neon-lit futuristic cyberpunk scene, glowing holograms, rain-slicked streets, sci-fi atmosphere, synthwave mood, purple and blue tones";
        const oilStyle = "An impressionist oil painting, heavy textured brush strokes, artistic lighting, vivid colors, Van Gogh inspired masterpiece";
        const pixarStyle = "A cute 3D Pixar-style render, soft lighting, expressive characters, smooth surfaces, ambient occlusion, 4k render";
        const darkStyle = "A dark fantasy gothic atmosphere, mysterious, moody lighting, fog, eerie details, eldritch horror style, muted colors";

        let currentStyle = cinematicStyle;
        let currentImageUrl = ""; 

        // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
        function setStyle(btn, styleDetails) {
            document.querySelectorAll('.style-btn').forEach(b => {
                b.className = 'style-btn group relative overflow-hidden rounded-xl p-3 border border-white/5 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-300 text-left';
            });
            btn.className = 'style-btn group active relative overflow-hidden rounded-xl p-3 border text-left transition-all duration-300 bg-gradient-to-br from-pink-600 to-purple-700 border-pink-400/50 ring-2 ring-pink-500/30 shadow-lg shadow-pink-900/20 scale-[1.02]';
            currentStyle = styleDetails;
        }

        // --- æ–°ç‰ˆï¼šä½¿ç”¨ SiliconFlow AI é€²è¡Œç¿»è­¯ ---
        async function translateToEnglish(text) {
            // å¦‚æœæ²’æœ‰ Key æˆ–æ²’æœ‰è¼¸å…¥æ–‡å­—ï¼Œç›´æ¥è¿”å›åŸæ–‡
            if (!API_KEY || !text.trim()) {
                console.warn("æœªè¨­å®š API KEY æˆ–è¼¸å…¥ç‚ºç©ºï¼Œè·³é AI ç¿»è­¯");
                return text;
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: MODEL_NAME,
                        messages: [
                            {
                                role: "system",
                                content: "You are a professional prompt engineer for AI image generation. Translate the user's Chinese description into descriptive, high-quality English suitable for text-to-image models. Direct translation only, no explanations."
                            },
                            {
                                role: "user",
                                content: text
                            }
                        ],
                        stream: false
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                const translatedText = data.choices[0].message.content.trim();
                console.log("AI Translated:", translatedText);
                return translatedText;

            } catch (error) {
                console.error("Translation failed:", error);
                alert("AI ç¿»è­¯é€£ç·šå¤±æ•—ï¼Œå°‡ä½¿ç”¨åŸå§‹æ–‡å­—ç”Ÿæˆ (è«‹æª¢æŸ¥ Console æˆ– API Key)");
                return text; // å¤±æ•—æ™‚é€€å›åŸæ–‡
            }
        }

        // ç”¢ç”Ÿåœ–ç‰‡
        async function generateImage() {
            const story = document.getElementById('storyInput').value;
            if (!story.trim()) {
                const inputArea = document.getElementById('storyInput');
                inputArea.classList.add('ring-2', 'ring-red-500', 'animate-pulse');
                setTimeout(() => inputArea.classList.remove('ring-2', 'ring-red-500', 'animate-pulse'), 1000);
                return;
            }

            // UI ç‹€æ…‹æ›´æ–°
            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btnText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const statusText = document.getElementById('statusText');
            const resultCard = document.getElementById('resultCard');
            const img = document.getElementById('resultImage');
            const promptDisplay = document.getElementById('promptDisplay');

            btn.disabled = true;
            btnText.innerText = 'è™•ç†ä¸­...';
            
            resultCard.classList.remove('hidden');
            img.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            
            setTimeout(() => {
                resultCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);

            try {
                // 1. ç¿»è­¯ (æ›´æ–°ç‹€æ…‹æ–‡å­—)
                statusText.innerText = "AI æ­£åœ¨ç†è§£ä¸¦ç¿»è­¯æ‚¨çš„æè¿°...";
                const translated = await translateToEnglish(story);

                // 2. çµ„åˆ Prompt
                statusText.innerText = "æ­£åœ¨ç¹ªè£½åœ–åƒ...";
                const seed = Math.floor(Math.random() * 1000000);
                const finalPrompt = `${currentStyle}. ${translated}`;
                
                // 3. æ§‹å»º URL
                const imageUrl = "https://image.pollinations.ai/prompt/" +
                    encodeURIComponent(finalPrompt)
                    + `?width=1080&height=1080&seed=${seed}&model=flux&nologo=true`;

                currentImageUrl = imageUrl;
                
                // 4. è¼‰å…¥åœ–ç‰‡
                const tempImg = new Image();
                tempImg.onload = function() {
                    img.src = imageUrl;
                };
                tempImg.src = imageUrl;
                
                // é¡¯ç¤ºç¿»è­¯å¾Œçš„æ–‡å­—ï¼Œè®“ä½¿ç”¨è€…çŸ¥é“ AI ç†è§£äº†ä»€éº¼
                promptDisplay.innerText = translated;

            } catch (e) {
                alert("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
                btn.disabled = false;
                btnText.innerText = 'AI ç¿»è­¯ä¸¦ç”Ÿæˆ';
                loadingSpinner.classList.add('hidden');
            }
        }

        // åœ–ç‰‡è¼‰å…¥å®Œæˆå›èª¿
        function onImageLoad() {
            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btnText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const img = document.getElementById('resultImage');

            loadingSpinner.classList.add('hidden');
            img.classList.remove('hidden');
            img.classList.add('fade-in');

            btn.disabled = false;
            btnText.innerText = 'å†ç”Ÿæˆä¸€å¼µ';
        }

        // ä¸‹è¼‰åœ–ç‰‡åŠŸèƒ½
        async function downloadCurrentImg() {
            if (!currentImageUrl) return;

            const downloadBtn = document.getElementById('downloadBtn');
            const originalContent = downloadBtn.innerHTML;
            
            downloadBtn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> ä¸‹è¼‰ä¸­';
            downloadBtn.disabled = true;

            try {
                const response = await fetch(currentImageUrl);
                const blob = await response.blob();
                const blobUrl = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = blobUrl;
                
                const timestamp = new Date().toISOString().replace(/[-:T.]/g, '').slice(0, 14);
                link.download = `AI_Scene_${timestamp}.jpg`;
                
                document.body.appendChild(link);
                link.click();
                
                document.body.removeChild(link);
                URL.revokeObjectURL(blobUrl);

            } catch (error) {
                console.error("Download failed:", error);
                window.open(currentImageUrl, '_blank');
            } finally {
                setTimeout(() => {
                    downloadBtn.innerHTML = '<i class="fas fa-check"></i> å®Œæˆ';
                    setTimeout(() => {
                        downloadBtn.innerHTML = originalContent;
                        downloadBtn.disabled = false;
                    }, 2000);
                }, 500);
            }
        }
    </script>
</body>
</html>